<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Behavioural experiments</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<!-- ###### start inserted header ##### -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115940772-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115940772-1');
</script>

<!-- add the twitter card and open graph tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@djnavarro">
<meta property="og:url" content="http://compcogscisydney.org/psyr/">
<meta property="og:title" content="R for Psychological Science">
<meta property="og:description" content="An introductory resource">
<meta property="og:image" content="http://compcogscisydney.org/psyr/img/splash_turtle.png">

<!-- ###### end inserted header ##### -->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="mystyle.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Psychological Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Core
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="variables.html">Variables</a>
    </li>
    <li>
      <a href="scripts.html">Scripts</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="workspaces.html">Workspaces</a>
    </li>
    <li>
      <a href="vectors.html">Vectors</a>
    </li>
    <li>
      <a href="loops.html">Loops</a>
    </li>
    <li>
      <a href="branches.html">Branches</a>
    </li>
    <li>
      <a href="functions.html">Functions</a>
    </li>
    <li>
      <a href="programming.html">Programming</a>
    </li>
    <li>
      <a href="file-system.html">File system</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="prelude-to-data.html">Prelude</a>
    </li>
    <li>
      <a href="data-types.html">Data types</a>
    </li>
    <li>
      <a href="describing-data.html">Describing data</a>
    </li>
    <li>
      <a href="visualising-data.html">Visualising data</a>
    </li>
    <li>
      <a href="manipulating-data.html">Manipulating data</a>
    </li>
    <li>
      <a href="working-with-text.html">Text data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Stats
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="xx-distributions.html">Probability distributions</a>
    </li>
    <li>
      <a href="xx-introductory-statistics.html">Introductory statistics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="experiments.html">Experiments</a>
    </li>
    <li>
      <a href="shiny.html">Shiny apps</a>
    </li>
    <li>
      <a href="xx-miscellaneous.html">Miscellaneous</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://compcogscisydney.org">compcogscisydney.org</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Behavioural experiments</h1>

</div>


<p>In my experience, most people in psychology start using R because they need it to solve problems with data analysis. Either they need to organise a data set, visualise it cleanly, or apply a statistical tool to the data that isn‚Äôt available via any other mechanism. Those are the areas in which R has traditionally held an advantage over other programming languages or other statistical software, and in my opinion that‚Äôs still the area where it‚Äôs strongest.</p>
<p>That being said, R is a proper programming language and you can use it for all sorts of other things. For example, one question I‚Äôm often asked is whether R can be used to run behavioural experiments. Of course the answer to that question is ‚Äúyes, absolutely‚Äù, but I think it‚Äôs worth thinking about when this is a good idea. There are a few examples I can think of where I‚Äôd strongly argue that R isn‚Äôt the right tool for the job:</p>
<ul>
<li>If all you need is a simple survey without a complicated design, tools like SurveyMonkey and Qualtrics are much easier to use and they‚Äôre not generally all that expensive. I‚Äôve never really found a use case for R in this context</li>
<li>If you need high precision timing and very low level control over stimulus presentation (i.e., down to the level of specifying exactly what happens at each screen refresh), I‚Äôd be wary about using R. Everything I‚Äôve read about how event handling in R works suggests that it‚Äôs just not as good as Python for that task.</li>
<li>More generally if you already know how to implement the experiment using a tool like jsPsych - which is free, open source and has a community of users in psychology alread - why switch? If your system isn‚Äôt broken don‚Äôt try to fix it.</li>
</ul>
<p>So what does that leave? When should you consider using R to implement a behavioural experiment? I can think of a few possibilities.</p>
<ul>
<li>If you have a text based task that doesn‚Äôt require very high precision timing, but has a more complicated interactive structure than is possible with a questionnaire, R can deliver a perfectly workable task without a lot of effort</li>
<li>If your task is graphics-based and you‚Äôre okay with running it on your own machine (i.e.¬†not online) you can repurpose the R graphics system for this.</li>
<li>If your experiment needs to take the form of a complicated web application and you aren‚Äôt already a skilled web programmer, you can build ‚ÄúShiny‚Äù apps through R that work really well</li>
</ul>
<p>In the long run I suspect most people will want to find other solutions to the problem besides R, but at the same time I think it‚Äôs really important to recognise that you can‚Äôt learn all the things at once. Just mastering one programming language is hard enough üòÄ so it‚Äôs worth the effort to try to get as much mileage out of that as possible!</p>
<p>With that in mind, I‚Äôll talk about all three of those use cases in these notes. The ‚ÄúShiny‚Äù approach is complex enough that I‚Äôve broken it off into its own <a href="./shiny.html">section</a>, but I‚Äôll talk about the other two approaches in this section.</p>
<div id="text-based-tasks" class="section level2">
<h2><span class="header-section-number">0.1</span> Text based tasks</h2>
<p>To start with, lets consider a very simple task. Imagine that we wanted to investigate how people play ‚Äú<a href="https://en.wikipedia.org/wiki/Hangman_(game)">hangman</a>. On the off chance you‚Äôre unfamiliar with the game, it‚Äôs a straightforward two player game. One player thinks of a word and the other person has to work it out by making a series of guesses as to what letters it contains. If the guesser works it out before making a predetermined number of errors then they win. To investigate this, we will need to implement this game in R, with the computer choosing the word and the human guessing. It‚Äôs a text based task, so we should be able to do the whole thing in the console. Some problems we‚Äôll need to solve:</p>
<ul>
<li>How do we present the current state of the game?</li>
<li>How do we get input from the participant?</li>
<li>How do we ‚Äúrefresh‚Äù the state of game after every event?</li>
<li>How do we record the data?</li>
</ul>
<p>Let‚Äôs start by writing a function called <code>show_hangman()</code> that will take three inputs, the <code>guesses</code> the person has made made so far, the <code>word</code> that the person needs to guess, and the total number of <code>errors</code> they‚Äôre allowed to make before losing.</p>
<pre class="r"><code>show_hangman &lt;- function(guesses, word, errors) {
  
  library(stringr)
  reg &lt;- function(x){ paste0(&quot;[&quot;,x,&quot;]&quot;) }
  
  # what letters are they missing
  missing &lt;- letters %&gt;% str_flatten() %&gt;% str_remove_all(reg(guesses))

  # what has the participant revealed
  stimulus &lt;- word %&gt;% str_replace_all(reg(missing),&quot;.&quot;)
  
  # how many errors?
  n_guess &lt;- guesses %&gt;% str_length()
  n_hit &lt;- guesses %&gt;% str_count(reg(word))
  n_err &lt;- n_guess - n_hit
  
  # print the results:
  cat(&quot;\n\n&quot;)
  cat(&quot;what you know:\n\n&quot;)
  cat(stimulus,&quot;\n\n&quot;)
  cat(&quot;your guesses:  &quot;, guesses, &quot;\n&quot;)
  cat(&quot;errors so far: &quot;, n_err, &quot;\n&quot;)
  cat(&quot;chances left:  &quot;, errors-n_err, &quot;\n\n&quot;)
  
}</code></pre>
<p>Here‚Äôs what that looks like:</p>
<pre class="r"><code>show_hangman(guesses = &quot;aest&quot;, word = &quot;computational&quot;, errors = 5)</code></pre>
<pre><code>## 
## 
## what you know:
## 
## .....tat...a. 
## 
## your guesses:   aest 
## errors so far:  2 
## chances left:   3</code></pre>
<p>That‚Äôs a good beginning! Next, we‚Äôll need a function that can ask the participant to make a guess, and store the response. The <code>readline()</code> function is good for this:</p>
<pre class="r"><code>prompt_user &lt;- function(){
  guess &lt;- readline(&quot;what letter would you like to guess next? &quot;)
  return(guess)
}</code></pre>
<p>Ideally, during our experiment what we would do is clear the screen every time a person makes a guess and then update the display. To do this, we‚Äôll need a function to clear any text from the console. This is handled differently depending on what system you‚Äôre using. I‚Äôll assume here that you‚Äôre working within RStudio, in which case the trick here is to send the ‚Äú<a href="https://en.wikipedia.org/wiki/Page_break">form feed</a>‚Äù character to the console<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<pre class="r"><code>clear_screen &lt;- function(){
  cat(&quot;\f&quot;) # form feed character
}</code></pre>
<p>This seems to be most of what we would need. However, we will probably also need a function that checks to see whether the game is over. Most of what we needed to do this is contained in the <code>show_hangman()</code> function above, but here it is is stripped down:</p>
<pre class="r"><code>game_state &lt;- function(guesses, word, errors) {
  
  library(stringr)
  reg &lt;- function(x){ paste0(&quot;[&quot;,x,&quot;]&quot;) }
  
  n_missing &lt;- word %&gt;% str_remove_all(reg(guesses)) %&gt;% str_length()
  if(n_missing == 0) {
    return(&quot;win&quot;)
  }
  
  # how many errors?
  n_guess &lt;- guesses %&gt;% str_length()
  n_hit &lt;- guesses %&gt;% str_count(reg(word))
  n_err &lt;- n_guess - n_hit
  if(n_err &gt;= errors) {
    return(&quot;lose&quot;)
  }
  
  return(&quot;continuing&quot;)
}</code></pre>
<p>Now we can organise this into a function that plays a game of hangman!</p>
<pre class="r"><code>hangman &lt;- function(word, errors) {
  
  guesses &lt;- &quot;&quot;
  state &lt;- &quot;continuing&quot;
  while(state == &quot;continuing&quot;) {
    
    clear_screen()
    show_hangman(guesses, word, errors)
    g &lt;- prompt_user()
    
    guesses &lt;- guesses %&gt;% str_c(g)
    state &lt;- game_state(guesses, word, errors)
  }
  
  dat &lt;- c(word = word, guesses = guesses, errors = errors, outcome = state)
  
  clear_screen()
  show_hangman(guesses, word, errors)
  
  return(dat)
}</code></pre>
<p>From there, all you need to do is put them all into a single script and you‚Äôre ready to go. The <a href="./scripts/hangman1.R">hangman1.R</a> script provides an example that plays one game of hangman, and <a href="./scripts/hangman2.R">hangman2.R</a> plays a series of three games and then stores the results in a data frame <code>d</code>. Obviously, in a real experiment you‚Äôd need to tidy the presentation, but I hope you get the idea.</p>
<div id="a-second-example" class="section level3">
<h3><span class="header-section-number">0.1.1</span> A second example</h3>
<p>As the hangman example illustrates, R allows you to create text based tasks and use them as the basis for experiments in a way that might be difficult to do with simpler tools like Qualtrics or SurveyMonkey. The key feature of R (or any programming language for that matter) that allows this flexibility is the ability to write complicated forms of <em>interactivity</em> into your experiment. For the hangman task, the experiment is able to rely on text processing tools to update the state of the game after every guess, and to adapt appropriately no matter what the participant does.</p>
<p>To give you a sense of how much further you can take this idea, imagine we were interested in studying how people solve strategic planning problems. An engaging way to do this is to implement a decision making problem in the form of a video game. Normally, this would require some fancy graphics to work, but thanks to the joy of emoji, you can go a suprisingly long way just using text.</p>
<p>The video below shows me playing a simple video game. Imagine you are a rabbit trying to get to a carrot, but there are a bunch of ‚Äúfire devils‚Äù that you need to avoid. We can use the w/a/s/d keys to navigate or q to quit the game. The fire devils are stupid and move randomly; when they bump into each other they merge together. When the game starts there are too many fire devils for it to be safe to try to cross to the carrot, so it might be wise to wait for some of them to burn out before venturing across to the carrot:</p>
<video width="600" controls>
<source src="./img/rabbit.webm" type="video/webm"> Your browser does not support the video tag.
</video>
<p>In this video, R is running at the Mac OS terminal rather than inside RStudio. I‚Äôm doing this because there is a package called <strong>keypress</strong> that only works through the terminal. In the hangman example, for a participant to make a response they need to type the letter and then press enter. For hangman that‚Äôs fine, but for the rabbit game it seems weird. So instead of using <code>readline</code> to get the user response I‚Äôm relying on the <code>keypress</code> function. If you‚Äôre interested, the code for <a href="./scripts/rabbit.R">rabbit.R</a> is available!</p>
</div>
<div id="a-third-example" class="section level3">
<h3><span class="header-section-number">0.1.2</span> A third example</h3>
<p>Just because I can‚Ä¶ the <a href="./scripts/guessing.R">guessing.R</a> provides an example of different kind of task, one in which the participant has to pick a number and the computer tries to guess it.</p>
</div>
</div>
<div id="graphical-tasks" class="section level2">
<h2><span class="header-section-number">0.2</span> Graphical tasks</h2>
<p>The rabbit example gives you a sense of how far you can go using nothing other than text, but in many situations you‚Äôll probably need something a little more sophisticated. The natural intuition that you might have is that we can use the R graphics system as the foundation for a psychological experiment: on every trial you‚Äôd use use a graphics tool (e.g. <code>ggplot</code>) to draw the stimulus on screen, and then the participant could respond using the keyboard or the mouse.</p>
<p>That intuition is correct, but we‚Äôll need to modify our approach a little bit. Earlier on when we discussed <a href="./visualising-data.html">data visualisation</a> I didn‚Äôt really talk much about the capabilities of different <em>graphics devices</em> because it didn‚Äôt matter much. In this context it starts to matter whether we draw the plot in the RStudio plot pane or somewhere else, because there are different graphics devices associated with each one, and only some of them are responsive to user input. Clearly, in order to design a behavioural experiment we will need to use a device that supports interactivity, and that means the RStudio graphics device is no good to us: it‚Äôs designed for the user to draw plots, not for interaction. On a Windows system you can use the default <code>windows()</code> graphics device, and on a Mac you can use <code>X11()</code>.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<p>The <a href="https://www.rdocumentation.org/packages/grDevices/versions/3.5.1/topics/getGraphicsEvent">getGraphicsEvent</a> function solves our problem. An example of this is included in the <a href="./scripts/correlationtask.R">correlationtask.R</a> script.</p>
<p><strong>[to be continued‚Ä¶]</strong></p>
</div>
<div id="shiny-apps" class="section level2">
<h2><span class="header-section-number">0.3</span> Shiny apps?</h2>
<p>The third and most sophisticated approach is to build a web application using Shiny. This has a number of advantages. Firstly, you can run a Shiny app locally on your machine or deploy it to the internet - so you can collect online data easily. Secondly, it has a lot more flexibility in terms of what you can do with it. However, the advantages do come at a cost. There‚Äôs a certain amount of effort involved in learning how to build a Shiny app, and some additional work to adapt the framework to behavioural experiments. It‚Äôs a big enough topic that I‚Äôm not going to try to force it into a subsection here. Instead, there‚Äôs a whole section devoted to <a href="./shiny.html">shiny</a>!</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Form feed dates back to the early days of computing and doesn‚Äôt serve much of a purpose anymore, but it‚Äôs still recognised. As a consequence many software packages have co-opted it and used it for other purposes. Since the original definition was something like ‚Äúclear the current page from the printer‚Äù, it makes some sense to use it to mean ‚Äúclear the current console log from the screen‚Äù<a href="#fnref1">‚Ü©</a></p></li>
<li id="fn2"><p>Note that newer Macs don‚Äôt ship with X11 by default anymore: you can download <a href="https://www.xquartz.org/">XQuartz</a> to fix this<a href="#fnref2">‚Ü©</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
