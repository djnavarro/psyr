<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<!-- ###### start inserted header ##### -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115940772-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115940772-1');
</script>

<!-- add the twitter card and open graph tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@djnavarro">
<meta property="og:url" content="http://compcogscisydney.org/psyr/">
<meta property="og:title" content="R for Psychological Science">
<meta property="og:description" content="An introductory resource">
<meta property="og:image" content="http://compcogscisydney.org/psyr/img/splash_turtle.png">

<!-- ###### end inserted header ##### -->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="mystyle.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Psychological Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Core
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="variables.html">Variables</a>
    </li>
    <li>
      <a href="scripts.html">Scripts</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="workspaces.html">Workspaces</a>
    </li>
    <li>
      <a href="vectors.html">Vectors</a>
    </li>
    <li>
      <a href="loops.html">Loops</a>
    </li>
    <li>
      <a href="branches.html">Branches</a>
    </li>
    <li>
      <a href="functions.html">Functions</a>
    </li>
    <li>
      <a href="programming.html">Programming</a>
    </li>
    <li>
      <a href="file-system.html">File system</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="prelude-to-data.html">Prelude</a>
    </li>
    <li>
      <a href="data-types.html">Data types</a>
    </li>
    <li>
      <a href="describing-data.html">Describing data</a>
    </li>
    <li>
      <a href="visualising-data.html">Visualising data</a>
    </li>
    <li>
      <a href="manipulating-data.html">Manipulating data</a>
    </li>
    <li>
      <a href="working-with-text.html">Text data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Stats
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="xx-distributions.html">Probability distributions</a>
    </li>
    <li>
      <a href="xx-introductory-statistics.html">Introductory statistics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="experiments.html">Experiments</a>
    </li>
    <li>
      <a href="shiny.html">Shiny apps</a>
    </li>
    <li>
      <a href="web-scraping.html">Web scraping</a>
    </li>
    <li>
      <a href="xx-miscellaneous.html">Miscellaneous</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://compcogscisydney.org">compcogscisydney.org</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore"><ol start="16" style="list-style-type: decimal">
<li>Manipulating data</li>
</ol></h1>

</div>


<style type="text/css">
h1{
  line-height: 100px;
}
h2{
  line-height: 80px;
}
h3{
  line-height: 60px;
}
</style>
<p>Data manipulation isn‚Äôt a particularly well defined topic. I take it to cover a few topics:</p>
<ul>
<li>Importing and exporting data</li>
<li>Cleaning up errors in data</li>
<li>Reorganising data</li>
</ul>
<p>Earlier sections of the notes covered variations of this:</p>
<ul>
<li>Reading and writing from CSV files and .RData files</li>
<li>Creating data frames, tibbles and factors from other input</li>
<li>Using filter and select to extract subsets of a data frame</li>
<li>Using mutate to create or alter columns in a data frame</li>
<li>Using arrange to sort a data frame</li>
</ul>
<div id="an-illustrative-problem" class="section level2">
<h2><span class="header-section-number">16.1</span> An illustrative problem</h2>
<p>In the <a href="./visualising-data.html">data visualisation</a> we used a data set looking at inductive reasoning stored in the <a href="./data/frames_ex2.csv">frames_ex2.csv</a> file. Here it is again:</p>
<pre class="r"><code>frames &lt;- read_csv(&quot;./data/frames_ex2.csv&quot;)
frames</code></pre>
<pre><code>## # A tibble: 4,725 x 8
##       id gender   age condition sample_size n_obs test_item response
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;     &lt;int&gt;    &lt;int&gt;
##  1     1 male      36 category  small           2         1        8
##  2     1 male      36 category  small           2         2        7
##  3     1 male      36 category  small           2         3        6
##  4     1 male      36 category  small           2         4        6
##  5     1 male      36 category  small           2         5        5
##  6     1 male      36 category  small           2         6        6
##  7     1 male      36 category  small           2         7        3
##  8     1 male      36 category  medium          6         1        9
##  9     1 male      36 category  medium          6         2        7
## 10     1 male      36 category  medium          6         3        5
## # ... with 4,715 more rows</code></pre>
<p>In this file the data are stored in <em>long form</em>, in which there is one row for every trial in the experiment and thus the data from each participant are spread across several rows. I stored the data in that format because it was handy for drawing pictures, but as it happen this isn‚Äôt how the data set was stored when I extracted it from the <a href="https://osf.io/j4dxm/">OSF repository</a> in which I‚Äôd deposited it only a few months earlier! Here‚Äôs what it looked like when I found it:</p>
<pre class="r"><code>wide_frames &lt;- read_csv(&quot;./data/frames_ex2_wide.csv&quot;)
wide_frames</code></pre>
<pre><code>## # A tibble: 225 x 25
##       ID Gender   Age Sampling `SS2-R1` `SS2-R2` `SS2-R3` `SS2-R4` `SS2-R5`
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;       &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
##  1     1 male      36 category        8        7        6        6        5
##  2     2 male      46 category        7        5        5        5        5
##  3     3 female    33 property        8        7        7        4        4
##  4     4 female    71 property        6        7        6        6        3
##  5     5 female    23 property        9        9        9        9        9
##  6     6 female    31 category        7        7        7        8        8
##  7     7 male      23 property        6        7        5        4        3
##  8     8 female    31 property        4        4        2        4        4
##  9     9 female    37 category        9        9        7        5        0
## 10    10 female    46 category        8        6        4        4        4
## # ... with 215 more rows, and 16 more variables: `SS2-R6` &lt;int&gt;,
## #   `SS2-R7` &lt;int&gt;, `SS6-R1` &lt;int&gt;, `SS6-R2` &lt;int&gt;, `SS6-R3` &lt;int&gt;,
## #   `SS6-R4` &lt;int&gt;, `SS6-R5` &lt;int&gt;, `SS6-R6` &lt;int&gt;, `SS6-R7` &lt;int&gt;,
## #   `SS12-R1` &lt;int&gt;, `SS12-R2` &lt;int&gt;, `SS12-R3` &lt;int&gt;, `SS12-R4` &lt;int&gt;,
## #   `SS12-R5` &lt;int&gt;, `SS12-R6` &lt;int&gt;, `SS12-R7` &lt;int&gt;</code></pre>
<p>In this file, the data are stored in <em>wide form</em>. The data frame contains only one row per person, and each judgment they make is stored as a separate variable. Wide and long form data are useful for a number of purposes. How do we switch between them, ‚Äúreshaping‚Äù the data to the form we need?</p>
<p>Once upon a time this used to be a difficult task, so much so that I wrote my own (not very good) functions that would solve this problem in a way that didn‚Äôt expose my students to some of the more frustrating aspects of data manipulation. Thankfully, this has changed. There is a little package distributed with the tidyverse called <strong>tidyr</strong> and it is remarkably effective at solving a range of reshaping problems in a (fairly) intuitive way.</p>
</div>
<div id="reshaping-a-data-frame" class="section level2">
<h2><span class="header-section-number">16.2</span> Reshaping a data frame</h2>
<pre class="r"><code>long_frames &lt;- wide_frames %&gt;% 
  gather(key = &quot;query&quot;, value=&quot;response&quot;,
         &quot;SS2-R1&quot;, &quot;SS2-R2&quot;,&quot;SS2-R3&quot;,&quot;SS2-R4&quot;,&quot;SS2-R5&quot;,&quot;SS2-R6&quot;,&quot;SS2-R7&quot;,
         &quot;SS6-R1&quot;,&quot;SS6-R2&quot;,&quot;SS6-R3&quot;,&quot;SS6-R4&quot;,&quot;SS6-R5&quot;,&quot;SS6-R6&quot;,&quot;SS6-R7&quot;, 
         &quot;SS12-R1&quot;,&quot;SS12-R2&quot;,&quot;SS12-R3&quot;,&quot;SS12-R4&quot;,&quot;SS12-R5&quot;,&quot;SS12-R6&quot;,&quot;SS12-R7&quot;)
long_frames</code></pre>
<pre><code>## # A tibble: 4,725 x 6
##       ID Gender   Age Sampling query  response
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt;
##  1     1 male      36 category SS2-R1        8
##  2     2 male      46 category SS2-R1        7
##  3     3 female    33 property SS2-R1        8
##  4     4 female    71 property SS2-R1        6
##  5     5 female    23 property SS2-R1        9
##  6     6 female    31 category SS2-R1        7
##  7     7 male      23 property SS2-R1        6
##  8     8 female    31 property SS2-R1        4
##  9     9 female    37 category SS2-R1        9
## 10    10 female    46 category SS2-R1        8
## # ... with 4,715 more rows</code></pre>
<p>To go back the other way, we could do this:</p>
<pre class="r"><code>long_frames %&gt;% spread(key = &quot;query&quot;, value = &quot;response&quot;)</code></pre>
<pre><code>## # A tibble: 225 x 25
##       ID Gender   Age Sampling `SS12-R1` `SS12-R2` `SS12-R3` `SS12-R4`
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;        &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
##  1     1 male      36 category         8         7         6         6
##  2     2 male      46 category         9         9         8         8
##  3     3 female    33 property         8         9         9         2
##  4     4 female    71 property         9         8         3         2
##  5     5 female    23 property         9         9         9         9
##  6     6 female    31 category         9         9         8         8
##  7     7 male      23 property         8         7         6         2
##  8     8 female    31 property         8         8         7         7
##  9     9 female    37 category         9         8         1         0
## 10    10 female    46 category         9         9         8         6
## # ... with 215 more rows, and 17 more variables: `SS12-R5` &lt;int&gt;,
## #   `SS12-R6` &lt;int&gt;, `SS12-R7` &lt;int&gt;, `SS2-R1` &lt;int&gt;, `SS2-R2` &lt;int&gt;,
## #   `SS2-R3` &lt;int&gt;, `SS2-R4` &lt;int&gt;, `SS2-R5` &lt;int&gt;, `SS2-R6` &lt;int&gt;,
## #   `SS2-R7` &lt;int&gt;, `SS6-R1` &lt;int&gt;, `SS6-R2` &lt;int&gt;, `SS6-R3` &lt;int&gt;,
## #   `SS6-R4` &lt;int&gt;, `SS6-R5` &lt;int&gt;, `SS6-R6` &lt;int&gt;, `SS6-R7` &lt;int&gt;</code></pre>
</div>
<div id="splitting-a-variable" class="section level2">
<h2><span class="header-section-number">16.3</span> Splitting a variable</h2>
<p>The <code>long_frames</code> data frame we created is close to what we need, but the <code>query</code> variable isn‚Äôt quite right. A value of <code>&quot;SS2-R1&quot;</code> corresponds to a trial on which the sample size was 2 and the test item was 1. This should properly be two variables, one specifying the <code>sample_size</code> and the other specifying the value of the <code>test_item</code>.</p>
<pre class="r"><code>long_frames %&gt;% 
  separate(
    col = query, 
    into = c(&quot;sample_size&quot;,&quot;test_item&quot;), 
    sep = &quot;-R&quot;
  )</code></pre>
<pre><code>## # A tibble: 4,725 x 7
##       ID Gender   Age Sampling sample_size test_item response
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;        &lt;int&gt;
##  1     1 male      36 category SS2         1                8
##  2     2 male      46 category SS2         1                7
##  3     3 female    33 property SS2         1                8
##  4     4 female    71 property SS2         1                6
##  5     5 female    23 property SS2         1                9
##  6     6 female    31 category SS2         1                7
##  7     7 male      23 property SS2         1                6
##  8     8 female    31 property SS2         1                4
##  9     9 female    37 category SS2         1                9
## 10    10 female    46 category SS2         1                8
## # ... with 4,715 more rows</code></pre>
<p>Getting closer. Note that there is a <code>unite()</code> function that reverses this operation, so if you ever need to collapse multiple columns into a single variable that would be the way to do it. It‚Äôs also worth noting that the two new variables aren‚Äôt quite in the format we want them to be. For instance, the <code>test_item</code> variable should be numeric rather than character, so lets <code>mutate</code> that and store the results:</p>
<pre class="r"><code>long_frames &lt;- long_frames %&gt;% 
  separate(
    col = query, 
    into = c(&quot;sample_size&quot;,&quot;test_item&quot;), 
    sep = &quot;-R&quot;
  ) %&gt;%
  mutate(test_item = as.numeric(test_item))
long_frames</code></pre>
<pre><code>## # A tibble: 4,725 x 7
##       ID Gender   Age Sampling sample_size test_item response
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;    &lt;int&gt;
##  1     1 male      36 category SS2                 1        8
##  2     2 male      46 category SS2                 1        7
##  3     3 female    33 property SS2                 1        8
##  4     4 female    71 property SS2                 1        6
##  5     5 female    23 property SS2                 1        9
##  6     6 female    31 category SS2                 1        7
##  7     7 male      23 property SS2                 1        6
##  8     8 female    31 property SS2                 1        4
##  9     9 female    37 category SS2                 1        9
## 10    10 female    46 category SS2                 1        8
## # ... with 4,715 more rows</code></pre>
</div>
<div id="recoding-variables" class="section level2">
<h2><span class="header-section-number">16.4</span> Recoding variables</h2>
<div id="using-recode" class="section level3">
<h3><span class="header-section-number">16.4.1</span> Using <code>recode()</code></h3>
<p>What should we do with the <code>sample_size</code> variable?</p>
<pre class="r"><code>long_frames &lt;- long_frames %&gt;%
  mutate(sample_size = dplyr::recode(
    sample_size, 
    &quot;SS2&quot; = &quot;small&quot;, 
    &quot;SS6&quot; = &quot;medium&quot;, 
    &quot;SS12&quot; = &quot;large&quot;)
  )
long_frames</code></pre>
<pre><code>## # A tibble: 4,725 x 7
##       ID Gender   Age Sampling sample_size test_item response
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;    &lt;int&gt;
##  1     1 male      36 category small               1        8
##  2     2 male      46 category small               1        7
##  3     3 female    33 property small               1        8
##  4     4 female    71 property small               1        6
##  5     5 female    23 property small               1        9
##  6     6 female    31 category small               1        7
##  7     7 male      23 property small               1        6
##  8     8 female    31 property small               1        4
##  9     9 female    37 category small               1        9
## 10    10 female    46 category small               1        8
## # ... with 4,715 more rows</code></pre>
</div>
<div id="using-case_when" class="section level3">
<h3><span class="header-section-number">16.4.2</span> Using <code>case_when()</code></h3>
<p>An alternative method is to use <code>case_when()</code>.</p>
<pre class="r"><code>long_frames &lt;- long_frames %&gt;%
  mutate(n_obs = case_when(
    sample_size == &quot;small&quot; ~ 2,
    sample_size == &quot;medium&quot; ~ 6,
    sample_size == &quot;large&quot; ~ 12
  ))
long_frames</code></pre>
<pre><code>## # A tibble: 4,725 x 8
##       ID Gender   Age Sampling sample_size test_item response n_obs
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;
##  1     1 male      36 category small               1        8     2
##  2     2 male      46 category small               1        7     2
##  3     3 female    33 property small               1        8     2
##  4     4 female    71 property small               1        6     2
##  5     5 female    23 property small               1        9     2
##  6     6 female    31 category small               1        7     2
##  7     7 male      23 property small               1        6     2
##  8     8 female    31 property small               1        4     2
##  9     9 female    37 category small               1        9     2
## 10    10 female    46 category small               1        8     2
## # ... with 4,715 more rows</code></pre>
<p>Now we have a data frame that is almost identical to the one we imported in the previous section. Apart from some cosmetic changes to variable names and order, the job is complete!</p>
</div>
</div>
<div id="processing-dates" class="section level2">
<h2><span class="header-section-number">16.5</span> Processing dates</h2>
<p>Empirical data sets often include date fields. Sometimes these dates are nicely formatted and are easy to work with. Most of the time they are not. Even if they were, dates are inherently painful: a year isn‚Äôt a perfect multiple of days, so a solar calendar needs leap years and other corrections. The year doesn‚Äôt divide easily into 12 months so months have a variable number of days and doing ‚Äúaddition‚Äù with months is really weird. The week days don‚Äôt distribute themelves cleanly across months or years, so those are a headache too ü§ï. It‚Äôs not purely an issue of nomenclature. We organise our lives around seasons, weekdays/weekends, day/night and various other cycles that don‚Äôt always play nicely with one another. The weirdness of dates reflects the structure of the world and our lives, and data analysts can‚Äôt pretend that this complexity isn‚Äôt there. To make things more annoying there are cultural and lingustic variations even within the English speaking world, so that is an additional source of ambiguity. Does 9/11 refer to September 11 or November 9? It depends on where you live. ü§∑. Because of all this, date specification is hard. The <code>Date</code> class in R provides a relatively decent way to handle this kind of data, and the <strong>lubridate</strong> package (another tidyverse one!) provides a very helpful tool to make it easier. It doesn‚Äôt load automatically so lets do that now:</p>
<pre class="r"><code>library(lubridate)</code></pre>
<div id="getting-started" class="section level3">
<h3><span class="header-section-number">16.5.1</span> Getting started</h3>
<p>Date information is often specified in terms of ‚Äúyear‚Äù, ‚Äúmonth‚Äù and ‚Äúday‚Äù, though not always in that order. <strong>lubridate</strong> provides a collection of functions <code>ymd</code>, <code>mdy</code>, etc that are fairly smart and able to parse information in many different formats. As long as you know the order of the information, these functions work really well:</p>
<pre class="r"><code>ymd(20101215)
ymd(&quot;2010/12/15&quot;)
ymd(&quot;2010 December 15&quot;)</code></pre>
<pre><code>## [1] &quot;2010-12-15&quot;
## [1] &quot;2010-12-15&quot;
## [1] &quot;2010-12-15&quot;</code></pre>
<p>Despite the variations in formatting the function is able to work out that these all correspond to the same date and returns an variable of class <code>Date</code>. This gives you quite a bit of flexibility:</p>
<pre class="r"><code>ymd(20101215) == mdy(&quot;12/15/10&quot;)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Nice! The functions are smart enough to handle strings and numbers as input, and if the year is indeterminate it assumes a 21st century date. That said, they do rely on you knowing the correct order. The same numeric input, formatted differently‚Ä¶</p>
<pre class="r"><code>dmy(20101215)</code></pre>
<pre><code>## [1] &quot;1215-10-20&quot;</code></pre>
<p>‚Ä¶ might indeed correspond to 20th October 1215. This might be plausible if the data set somehow pertained to the Magna Carta, but probably not for most settings of interest to psychologists!</p>
</div>
<div id="a-real-world-example" class="section level3">
<h3><span class="header-section-number">16.5.2</span> A real world example</h3>
<p>To give you a sense of how annoying working with dates can be, the following is a real example. I asked my partner ‚Äì who in real life is a statistics consultant among other things ‚Äì to send me a data set she‚Äôd been sent with poorly formatted date information. This is what she sent me:</p>
<pre class="r"><code>oddball &lt;- readLines(&quot;./data/oddballdate2.csv&quot;)
oddball</code></pre>
<pre><code>##  [1] &quot;4/4/16 9:00&quot;   &quot;4/4/16 14:13&quot;  &quot;6/4/16 5:55&quot;   &quot;6/4/16 11:27&quot; 
##  [5] &quot;8/4/16 15:04&quot;  &quot;12/4/16 12:29&quot; &quot;14/4/16 12:14&quot; &quot;14/4/16 19:16&quot;
##  [9] &quot;18/4/16 16:18&quot; &quot;20/4/16 11:10&quot; &quot;28/4/16 16:10&quot; &quot;28/4/16&quot;      
## [13] &quot;1/5/16 17:11&quot;  &quot;2/5/16 14:53&quot;  &quot;3/5/16 10:32&quot;  &quot;3/5/16 12:46&quot; 
## [17] &quot;3/5/16 13:08&quot;  &quot;3/5/16 15:51&quot;  &quot;4/5/16 11:04&quot;  &quot;4/5/16 11:13&quot; 
## [21] &quot;4/5/16 11:16&quot;  &quot;4/5/16 12:54&quot;  &quot;4/5/16 14:40&quot;  &quot;4/5/16 20:16&quot; 
## [25] &quot;6/5/16 15:13&quot;  &quot;10/5/16 11:17&quot; &quot;11/5/16 12:41&quot; &quot;12/5/16&quot;      
## [29] &quot;12/5/16&quot;       &quot;5/13/16&quot;       &quot;16/5/16 10:11&quot; &quot;16/5/16 22:47&quot;
## [33] &quot;17/5/16 15:20&quot; &quot;18/5/16&quot;       &quot;18/5/16 10:32&quot; &quot;19/5/16 2:27&quot; 
## [37] &quot;19/5/16 10:59&quot; &quot;19/5/16&quot;</code></pre>
<p>To keep this example minimal, I‚Äôve used <code>readLines()</code> to import the data as a single character vector. As you can see this pretty inconsistent, and my partner‚Äôs face when I turned to her in horror can only be described with emoji: üòà</p>
<p>A brief look at this suggests that <em>most</em> of the data have a time stamp as well as date information, which suggests that the <code>dmy_hm</code> function should be able to parse them. Others are date only, suggesting that <code>dmy</code> should work. If I try these individually this is what happens:</p>
<pre class="r"><code>dmy(oddball)</code></pre>
<pre><code>## Warning: 33 failed to parse.</code></pre>
<pre><code>##  [1] NA           NA           NA           NA           NA          
##  [6] NA           NA           NA           NA           NA          
## [11] NA           &quot;2016-04-28&quot; NA           NA           NA          
## [16] NA           NA           NA           NA           NA          
## [21] NA           NA           NA           NA           NA          
## [26] NA           NA           &quot;2016-05-12&quot; &quot;2016-05-12&quot; NA          
## [31] NA           NA           NA           &quot;2016-05-18&quot; NA          
## [36] NA           NA           &quot;2016-05-19&quot;</code></pre>
<pre class="r"><code>dmy_hm(oddball)</code></pre>
<pre><code>## Warning: 6 failed to parse.</code></pre>
<pre><code>##  [1] &quot;2016-04-04 09:00:00 UTC&quot; &quot;2016-04-04 14:13:00 UTC&quot;
##  [3] &quot;2016-04-06 05:55:00 UTC&quot; &quot;2016-04-06 11:27:00 UTC&quot;
##  [5] &quot;2016-04-08 15:04:00 UTC&quot; &quot;2016-04-12 12:29:00 UTC&quot;
##  [7] &quot;2016-04-14 12:14:00 UTC&quot; &quot;2016-04-14 19:16:00 UTC&quot;
##  [9] &quot;2016-04-18 16:18:00 UTC&quot; &quot;2016-04-20 11:10:00 UTC&quot;
## [11] &quot;2016-04-28 16:10:00 UTC&quot; NA                       
## [13] &quot;2016-05-01 17:11:00 UTC&quot; &quot;2016-05-02 14:53:00 UTC&quot;
## [15] &quot;2016-05-03 10:32:00 UTC&quot; &quot;2016-05-03 12:46:00 UTC&quot;
## [17] &quot;2016-05-03 13:08:00 UTC&quot; &quot;2016-05-03 15:51:00 UTC&quot;
## [19] &quot;2016-05-04 11:04:00 UTC&quot; &quot;2016-05-04 11:13:00 UTC&quot;
## [21] &quot;2016-05-04 11:16:00 UTC&quot; &quot;2016-05-04 12:54:00 UTC&quot;
## [23] &quot;2016-05-04 14:40:00 UTC&quot; &quot;2016-05-04 20:16:00 UTC&quot;
## [25] &quot;2016-05-06 15:13:00 UTC&quot; &quot;2016-05-10 11:17:00 UTC&quot;
## [27] &quot;2016-05-11 12:41:00 UTC&quot; NA                       
## [29] NA                        NA                       
## [31] &quot;2016-05-16 10:11:00 UTC&quot; &quot;2016-05-16 22:47:00 UTC&quot;
## [33] &quot;2016-05-17 15:20:00 UTC&quot; NA                       
## [35] &quot;2016-05-18 10:32:00 UTC&quot; &quot;2016-05-19 02:27:00 UTC&quot;
## [37] &quot;2016-05-19 10:59:00 UTC&quot; NA</code></pre>
<p>Each function converts the dates it can, inserts <code>NA</code> for the dates it can‚Äôt, and loudly complain that something is amiss. That‚Äôs pretty reasonable.</p>
<pre class="r"><code>d1 &lt;- oddball %&gt;% dmy_hm() %&gt;% date()
d2 &lt;- oddball %&gt;% dmy() 
clean_dates &lt;- case_when(
  is.na(d1) ~ d2, 
  TRUE ~ d1
  )
clean_dates</code></pre>
<pre><code>##  [1] &quot;2016-04-04&quot; &quot;2016-04-04&quot; &quot;2016-04-06&quot; &quot;2016-04-06&quot; &quot;2016-04-08&quot;
##  [6] &quot;2016-04-12&quot; &quot;2016-04-14&quot; &quot;2016-04-14&quot; &quot;2016-04-18&quot; &quot;2016-04-20&quot;
## [11] &quot;2016-04-28&quot; &quot;2016-04-28&quot; &quot;2016-05-01&quot; &quot;2016-05-02&quot; &quot;2016-05-03&quot;
## [16] &quot;2016-05-03&quot; &quot;2016-05-03&quot; &quot;2016-05-03&quot; &quot;2016-05-04&quot; &quot;2016-05-04&quot;
## [21] &quot;2016-05-04&quot; &quot;2016-05-04&quot; &quot;2016-05-04&quot; &quot;2016-05-04&quot; &quot;2016-05-06&quot;
## [26] &quot;2016-05-10&quot; &quot;2016-05-11&quot; &quot;2016-05-12&quot; &quot;2016-05-12&quot; NA          
## [31] &quot;2016-05-16&quot; &quot;2016-05-16&quot; &quot;2016-05-17&quot; &quot;2016-05-18&quot; &quot;2016-05-18&quot;
## [36] &quot;2016-05-19&quot; &quot;2016-05-19&quot; &quot;2016-05-19&quot;</code></pre>
<p>Well that <em>almost</em> worked. What‚Äôs the one <code>NA</code> value?</p>
<pre class="r"><code>oddball[is.na(clean_dates)]</code></pre>
<pre><code>## [1] &quot;5/13/16&quot;</code></pre>
<p>Sigh. Looking at all the other dates, every single one is in April or May‚Ä¶ but this last one is ostensibly on the 5th day of the 13th month? Obviously we have <em>one</em> entry formatted in a <code>mdy()</code> form. I will leave it as an exercise to the reader to work out how to fix that one üòÄ</p>
</div>
</div>
<div id="combining-data-frames" class="section level2">
<h2><span class="header-section-number">16.6</span> Combining data frames</h2>
<p>Another common data manipulation problem arises when we need to combine multiple data frames. Two versions of this problem are worth talking about, namely <em>binding</em> and <em>joining</em></p>
<div id="binding" class="section level3">
<h3><span class="header-section-number">16.6.1</span> Binding</h3>
<p>Binding data frames is simple. Suppose we have multiple data frames that have the same variables, and we want to concatenate them. For instance, here are three small data frames:</p>
<pre class="r"><code>nightgarden_top &lt;- read_csv(&quot;./data/nightgarden_top.csv&quot;)
nightgarden_middle &lt;- read_csv(&quot;./data/nightgarden_middle.csv&quot;)
nightgarden_bottom &lt;- read_csv(&quot;./data/nightgarden_bottom.csv&quot;)</code></pre>
<p>Each of these contains a subset of the rows we need:</p>
<pre class="r"><code>nightgarden_middle</code></pre>
<pre><code>## # A tibble: 2 x 3
##    line speaker     utterance
##   &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;    
## 1     6 tombliboo   oo       
## 2     7 makka-pakka pip</code></pre>
<p>We can use <code>dplyr::bind_rows()</code> to concatenate these data frames vertically:</p>
<pre class="r"><code>bind_rows(nightgarden_top, nightgarden_middle, nightgarden_bottom)</code></pre>
<pre><code>## # A tibble: 10 x 3
##     line speaker     utterance
##    &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;    
##  1     1 upsy-daisy  pip      
##  2     2 upsy-daisy  pip      
##  3     3 upsy-daisy  onk      
##  4     4 upsy-daisy  onk      
##  5     5 tombliboo   ee       
##  6     6 tombliboo   oo       
##  7     7 makka-pakka pip      
##  8     8 makka-pakka pip      
##  9     9 makka-pakka onk      
## 10    10 makka-pakka onk</code></pre>
<p>There is an analogous function <code>dplyr::bind_columns()</code> that concatenates horizontally.</p>
</div>
<div id="joining" class="section level3">
<h3><span class="header-section-number">16.6.2</span> Joining</h3>
<p>More complicated situations arise when each data frame potentially contains information about the same cases and variables, but not necessarily all the same ones. A common situation in which this arises in real research is when participants complete two different tasks (e.g.¬†a questionnaire and an experimental task) and the data are stored separately from each tasks. Ideally we might hope to have data from every participant for do both versions, but that does not always occur. As a toy example, suppose we collected some <code>demographics</code> for major characters from Terry Pratchett‚Äôs <em>Discworld</em> novels:</p>
<pre class="r"><code>demographics &lt;- read_csv(&quot;./data/discworld_demographics.csv&quot;)
demographics</code></pre>
<pre><code>## # A tibble: 4 x 3
##   id        gender residence   
##   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;       
## 1 rincewind male   ankh-morpork
## 2 vimes     male   ankh-morpork
## 3 granny    female lancre      
## 4 death     other  other</code></pre>
<p>Only some of the characters completed this questionnaire however. We might also have obtained <code>responses</code> from Discworld characters to some experimental task, and again we have partial data:</p>
<pre class="r"><code>responses &lt;- read_csv(&quot;./data/discworld_responses.csv&quot;)
responses</code></pre>
<pre><code>## # A tibble: 3 x 4
##   id     answer1 answer2 answer3
##   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 vimes  yes     no      no     
## 2 granny no      no      no     
## 3 brutha maybe   maybe   yes</code></pre>
<p>How should we <em>join</em> these two data frames together? In general there is no right or wrong answer to this question, merely different possibilities that will be of use in different situations:</p>
<ul>
<li>An inner join contains only those rows that appear in both data frames</li>
<li>A full join contains every row that appears in at least one data frame</li>
<li>A left join contains every row that appears in the first data frame</li>
<li>A right join contains every row that appears in the second data frame</li>
</ul>
<p>In order to work out which rows are matched in the different data frames, the default is to use any variable name that appears in both data sets (though this can be customised). For the <em>Discworld</em> data, the only two characters that appear in both the <code>demographics</code> data set and the <code>reponses</code> data are Vimes and Granny, so when we construct an inner join, we end up with a data frame that includes only those two characters:</p>
<pre class="r"><code>inner_join(demographics, responses)</code></pre>
<pre><code>## Joining, by = &quot;id&quot;</code></pre>
<pre><code>## # A tibble: 2 x 6
##   id     gender residence    answer1 answer2 answer3
##   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 vimes  male   ankh-morpork yes     no      no     
## 2 granny female lancre       no      no      no</code></pre>
<p>By contrast, if we construct a full join, every character is included in the result, with <code>NA</code> values inserted for all the missing cases:</p>
<pre class="r"><code>full_join(demographics, responses)</code></pre>
<pre><code>## Joining, by = &quot;id&quot;</code></pre>
<pre><code>## # A tibble: 5 x 6
##   id        gender residence    answer1 answer2 answer3
##   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 rincewind male   ankh-morpork &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   
## 2 vimes     male   ankh-morpork yes     no      no     
## 3 granny    female lancre       no      no      no     
## 4 death     other  other        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   
## 5 brutha    &lt;NA&gt;   &lt;NA&gt;         maybe   maybe   yes</code></pre>
<p>Suppose we want to retain data only for those characters that completed the <code>demographics</code> survey. A left join is what we need here:</p>
<pre class="r"><code>left_join(demographics, responses)</code></pre>
<pre><code>## Joining, by = &quot;id&quot;</code></pre>
<pre><code>## # A tibble: 4 x 6
##   id        gender residence    answer1 answer2 answer3
##   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 rincewind male   ankh-morpork &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   
## 2 vimes     male   ankh-morpork yes     no      no     
## 3 granny    female lancre       no      no      no     
## 4 death     other  other        &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;</code></pre>
<p>By analogy, if we wanted to retain data only for those characters that provided <code>responses</code>, we would use the <code>right_join()</code> function. It‚Äôs also worth noting that there also <code>semi_join()</code> and <code>anti_join()</code> functions that can handle other kinds of situations, but I won‚Äôt go into those here.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
